== Stack Object Combiner ==
Because of the cubic cost of the 3D segmentation (in memory and processing) with [http://ilastik.org/ Ilastik], it is not possible to work on full stacks of EM images in once.<br/>
To be fully segmented, the stack need to be cut in parts. But this operation will cut some objects in 2 or more parts, and the objects will lost the coordinate system of the original stack.<br/>
The purpose of this plugin is to replace the objects in their original position, and provide a tool that will allow a user to merge 3D objects that have been cut.

== Installation ==
The plugin can be found on the github [https://github.com/Tom-TBT/StackObjectCombiner/releases project] in the release tab (please take the lattest version of the plugin). <br/>
Download the .jar file and place it in the plugin folder of ImageJ. <br/>
This plugin also need the 
[https://mvnrepository.com/artifact/org.apache.commons/commons-math3 apache common maths] librairy. If you use Fiji, this librairy is already included. If you use ImageJ, download the lattest version and put the .jar file into ImageJ/plugins/jars/

== Usage ==
Because the coordinates system of the original stack have been lost, the plugin use a naming convention to know where the objects come from.

[[File:decoupage.png]]

The image show how the stacks parts are named. The object coming from a given part should be prefixed by the letter of the sub-stack (e.g. A_axon, C_dendrite, ...)<br/>

The plugin have now only one window, where every functions are presented.<br/>

First you have to give the directory where your meshes are stored. The plugin will then read the current directory to find meshes, with names corresponding to the prefixes mentioned above. All the recognized meshes will be added to 4 different lists, corresponding to their sub-stack.<br/><br/>

Then, the plugin allow you to shift your meshes, to put them in the original coordinate system of the full-stack. X & Y shift correspond to the size of the A_sub-stack. E.g, if your stack's voxel size is 1x1x1, and the A_sub-stack is 200x100x50, X shift = 200 & Y shift = 100.
Once the X & Y values are indicated, use the Shift button to shift the meshes. <br/>
Note that the plugin will add to each readed mesh a line in the file indicating that the mesh have been shifted (#movedBySOC), and allow then the mesh to be merged. If you don't need to shift your meshes, use 0 values for X & Y. Then indicate the actual size of the A_sub-stack because the plugin will use it to merge the meshes.<br/><br/>

To use the merge function, select two meshes in the lists proposed (select one and click on the ">>>" button, or use the "a" shortcut). You can set up here few parameters :
- Auto Save/Naming : It will unable the dialog asking for the name of the new mesh, and so create by itself a new unexisting name composed by the name of the two original meshes.
- Tail lenght : It correspond to the number of vertices removed from the extremities of linear borders. Because of the size of the window (see bellow), these vertices can't be removed simply by looking if they are close to the split or not.
- Window : It is the maximum distance at which a vertex can be considered as close to the border.
- Pairing : The last step of the merging is a pairing of the border's vertices, and this is done by creating sets of vertices each n vertices. This parameter correspond to the number n.<br/><br/><br/>

The plugin have been tested on a small number of meshes, and so far it works well on the differents shapes we merged. If you have troubles while merging your objects, do not hesitate to contact me. Your feedback can help me improve the plugin, and so allow you then to merge your meshes.

== Example ==

During this example, you can look at the different step with the [http://fiji.sc/3D_Viewer 3DViewer], or with [https://www.blender.org/ Blender].
<ol>
<li>Download the meshes of a mitochondria in the shape of a donut divided in 4 parts [[Media:MitoDonut Meshes.zip]]</li>
<li>Launch the plugin, and give the directory containing the .obj file</li>
<li>X shift : 192 &nbsp;&nbsp;&nbsp;Y shift : 214</li>
<li>Click on the Shift button to shift the meshes.</li>
<li>Now merge the meshes two by two. Select them and use the Merge button.</li>
<li>Merge then the two resulting meshes. Note that your meshes should start with names that correspond to neighbors sub-stacks (E.g. A_ & C_)</li>
<li>Look at the result</li>
</ol>

== Reference ==

This plugin haven't been published yet, but if you want to cite you can always refer to it as 
T. Boissonnet,"Stack Object Combiner plugin for ImageJ", http://imagej.net/StackObjectCombiner, October 2015

== Contact ==

For any suggestions, questions, problems or just to give feedback, please feel free to contact Tom Boissonnet at tom.boissonnet@hotmail.fr 

== Licence ==

This program is '''free software'''; you can redistribute it and/or modify it under the terms of the '''GNU General Public License''' as published by the Free Software Foundation ([http://www.gnu.org/licenses/gpl.txt http://www.gnu.org/licenses/gpl.txt]).

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.

== Futur improvements ==

The plugin is still in development. We intend to improve the plugin by adding parameters to the plugin and an automatic pairing of borders. Any suggestion is welcome.

== Errors ==

TODO Add the errors given by the plugin to this section

<ul>
<li>Error 1 : The repository contain only A_files. If the directory contain only A_files, the plugin can't do anything with them.</li>
<li>Error 2 : No meshes can be found. The plugin can't see any file.</li>
</ul>
If your repository contain your files but you still see this messages, it probably means that your objects are not named with the naming convention (see the Usage section).

<ul>
<li>Error 3 : The mesh don't cross the border. The given mesh don't cross the border and so it can't be merged to an other mesh.</li>
<li>Error 4 : Two meshes from a same part can't be merged. You can't merge two objects that came from the same part of the stack. You can still modify the name of the object.</li>
<li>Error 5 : Their is not enough meshes to merge. The plugin need at least two meshes to merge meshes.</li>
</ul>
