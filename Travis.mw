{{DevelopMenu | tools}}{{Minibox | logo=Travis.png | blurb='''Travis CI:''' Build your code in the cloud!}}[https://travis-ci.org/ Travis] is a tool for [[Project_management#Continuous_integration|continuous integration]]. It has excellent integration with [[GitHub]], and is very useful for automating builds, deployment and other tasks.
{{TOC}}
= Services =

[[ImageJ]] and [[SciJava]] projects use Travis in a variety of ways:

* Perform builds of SciJava projects. Travis deploys <code>SNAPSHOT</code> builds to the [http://maven.imagej.net/ ImageJ Maven repository] in response to pushes to each code repository's <code>master</code> branch. So any downstream projects depending on a version of <code>LATEST</code> for a given component will match the last successful Travis build—i.e., the latest code on <code>master</code>.
* Run each project's associated [[wikipedia:Unit testing|unit tests]]. Travis is instrumental in early detection of new bugs introduced to the codebase.
* Perform [[releases]] of [[SciJava]] projects. Travis deploys release builds to the appropriate Maven repository—typically either the ImageJ Maven repository or [https://oss.sonatype.org/ OSS Sonatype].
* Keep the [[javadoc]] site updated.
* Keep other web resources updated.

= Automatic Deployment of Maven Artifacts =

Deploying your library to a [[Maven]] repository makes it available for other developers. It is also a [[Fiji/Contribution_requirements|contribution requirement for the Fiji project]].

== Requirements ==
* Host your [[open-source]] project on [[GitHub]].
* Log in to [https://travis-ci.org/auth Travis CI] with your corresponding GitHub account and enable your repository.
* Contact an ImageJ admin in [[Chat#Gitter|Gitter]] or [http://forum.imagej.net/ the ImageJ forum] and request that they file a PR which adds Travis support to your repository.

== Instructions ==
<div style="overflow: hidden">
<tabs>
<tab name="Maven">
<ol>
<li>Use the following code for your repository's <code>.travis.yml</code>:
<br>{{GitHubEmbed|org=imagej|repo=imagej-common|path=.travis.yml}}
</li>
<li>Delete the entire <code>env</code> section, since we will be replacing it shortly.</li>
<li>From the command line in your repository, create an [https://docs.travis-ci.com/user/environment-variables/#Encrypting-Variables-Using-a-Public-Key encrypted environment variable] for <code>MAVEN_PASS</code> which defines the Maven password of the [[ImageJ Maven repository]]'s <code>travis</code> account.

<source lang="bash">
$ travis encrypt MAVEN_PASS=travis_maven_password --add env.global
</source>

Note that this will automatically modify your <code>.travis.yml</code> file.

'''If you are not a core ImageJ maintainer, you probably do not have this password.''' Finish the rest of these steps below, then start a topic on the [http://forum.imagej.net/ ImageJ Forum] asking for a core ImageJ maintainer to file a PR to your repository adding this encrypted variable.
</li>
<li>Add the following script as <code>.travis/build.sh</code>:
<br>{{GitHubEmbed|org=imagej|repo=imagej-common|path=.travis/build.sh}}
</li>
<li>Create a <code>settings.xml</code> in your repository with the following contents:
<br>{{GitHubEmbed|org=imagej|repo=imagej-common|path=.travis/settings.xml}}
</li>
<li>Commit all your files with Git and push them back to your repository. If everything works as intended, you should start seeing new builds in your [https://travis-ci.org Travis dashboard] with each new commit, with corresponding SNAPSHOT artifacts automatically deployed to [http://maven.imagej.net/index.html#view-repositories maven.imagej.net].
</li>
</ol>
</tab>
<tab name="Gradle">
<ol>
<li>Add the following code to your <code>build.gradle</code> file:
<source lang="Groovy">
// this _must_ be at the top, with the other plugins
apply plugin: 'maven'
apply plugin: 'maven-publish'

// more towards the end
uploadArchives {
    repositories {
        mavenDeployer {
            repository(url: "http://maven.imagej.net/content/repositories/releases") {
                authentication(userName: "$System.env.MAVEN_USER", password: "$System.env.MAVEN_PASS")
            }
            snapshotRepository(url: "http://maven.imagej.net/content/repositories/snapshots") {
                authentication(userName: "$System.env.MAVEN_USER", password: "$System.env.MAVEN_PASS")
            }
        }
    }
}
</source>

If you also want your Javadoc JAR to be published, also add the following:
<source lang="Groovy">
task javadocJar(type: Jar, dependsOn:javadoc) {
        classifier = 'javadoc'
        from javadoc.destinationDir
}

artifacts
{
        archives sourcesJar
        archives javadocJar
    archives testsJar
}

publishing {
        publications {
                maven(MavenPublication) {
                        from components.java
                        artifact sourcesJar { classifier "sources" }
                }
        }
}
</source>
</li>
<li>From the command line in your repository, create an [https://docs.travis-ci.com/user/environment-variables/#Encrypting-Variables-Using-a-Public-Key encrypted environment variable] for your [http://maven.imagej.net maven.imagej.net] username and password—be careful with escaping special characters correctly:

<source lang="bash">
$ travis encrypt MAVEN_USER=my_maven_username --add env.matrix
$ travis encrypt MAVEN_PASS=my_maven_password --add env.matrix
</source>

Note that this will automatically modify your <code>.travis.yml</code> file.
</li>
<li>Commit all your files with Git and push them back to your repository. If everything works as intended, you should start seeing new builds in your [https://travis-ci.org Travis dashboard] with each new commit, with corresponding SNAPSHOT and release artifacts immediately deployed automatically to [http://maven.imagej.net/index.html#view-repositories maven.imagej.net].
</li>
</ol>
</tab>
</tabs>
</div>

== Testing things which cannot run headless ==

If your tests require a display (i.e.: they do not pass when run [[headless]]), you can use [[Xvfb]] as follows:
<source lang="yml">
before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start
</source>
Of course, you should do this only as a last resort, since the best unit tests should not require a display in the first place.
