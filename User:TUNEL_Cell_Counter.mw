== TUNEL Cell Counter =={{Infobox
| logo                   = [[Image:fiji-icon.png|96px]]
| software               = Fiji
| name                   = TUNEL Cell Counter
| author                  = [[User:Daniel E. Maidana| '''Daniel E. Maidana, M.D.''']] <br> [https://connects.catalyst.harvard.edu/Profiles/display/Person/39774 '''Demetrios G. Vavvas, M.D., Ph.D.''']
| maintainer           = '''Daniel E. Maidana, M.D.''' <br> Angiogenesis Laboratory <br>Massachusetts Eye and Ear Infirmary <br> Harvard Medical School ([mailto:Daniel_Maidana@MEEI.HARVARD.EDU Daniel_Maidana@meei.harvard.edu])
| filename              = [https://github.com/DanielMaidana/TUNEL TUNEL Cell Counter at GitHub]
| source                 = {{GitHub|org=fiji|repo=TUNEL}}
| released              = August 8<sup>th</sup>, 2015
| latest version      = August 8<sup>th</sup>, 2015
| status                  = v1.1 beta
| category               =[[:Category:Plugins|Plugins]]
| website                = [https://github.com/DanielMaidana/TUNEL TUNEL Cell Counter at GitHub]
}}<br>[[Category:Development]]
'''TUNEL Cell Counter''' is a free, open source plugin created for ImageJ 2 and FIJI, developed by Daniel E. Maidana, M.D. and Demetrios G. Vavvas, M.D., Ph.D. at the Angiogenesis Laboratory, Massachusetts Eye and Ear Infirmary, Harvard Medical School. TUNEL Cell Counter has been validated for retinal TUNEL assay quantitation in cryo-sections. TUNEL Cell Counter is able to analyze digital images obtained from fluorescent microscopes, segment the outer nuclear (ONL) and inner nuclear layer (INL), and count TUNEL<sup>+</sup> cell in each layer. After analysis, TUNEL Cell Counter generates an array with several output variables. Additionally, the macro generates a merged image with segmented layers and quantitated cells, for visual assessment of macro performance. 
__TOC__

== Overview ==
TUNEL Cell Countehttp://imagej.net/User:TUNEL_Cell_Counterr is a custom-built and validated ImageJ macro that processes digital images from retinal TUNEL assay. It segments retinal outer nuclear (ONL) and inner nuclear layers (INL) and quantitates TUNEL+ cells in these layers. The detailed validation of this macro has been submitted and currently under review for publishing.

== Before You Start ==
Please read carefully before using this macro.
You will need the following information before you start quantitating images.
=== Microscope Calibration ===
[[File:Scale.png|200px|thumb|right|Replace the value 3095.975 in the source code with your microscope spatial scale.]]
To convert pixels-mm<sup>2</sup>, the image spatial scale is required. This can be found in the image metadata or in the microscope's bundled software.
:For example, we acquired images with Axio Imager M2 fluorescence microscope (Carl Zeiss Inc., NY) using a 20x/0.8 air objective. The spatial scale was: 3095.975 pixels/mm
<source lang="java">
  run("Set Scale...", "distance=3095.975 known=1 pixel=1 unit=mm global");
</source>
:Replace the value 3095.975 on code line 32 with your microscope spatial scale.
=== Image Acquisition ===
This macro was designed for images acquired with fluorescence microscopes using a 20x/0.8 air objective. 
We considered this magnification was the most suitable to assess a reasonably large area without missing out on details in cell morphology. 
=== Dataset Selection ===
The original ONL and INL image datasets used for validation purposes are available to download. These images have been accurately segmented and quantitated, and their values were validated by observers. 
{{Notice | We '''strongly''' recommend to download and revise these images beforehand, to have a rough estimate on acquisition and post-processing parameters.}}
=== Datasets Links ===
:*[https://www.dropbox.com/sh/yq7d6pac61niav9/AABw9L29qWfDAYH5K2SAaVUma?dl=0 ONL Dataset] 
:*[https://www.dropbox.com/sh/lu6qojkte1z41pf/AABJHv2uptUaWfx-mGUmn1nJa?dl=0 INL Dataset]
== Download & Install ==
=== TUNEL Cell Counter Setup ===
#Download the macro from the GitHub link.<br>
#Go to ''Plugins > Macros > Install'' and select the downloaded '''.ijm''' file.

== TUNEL Cell Counter ==
[[File:Stack - Macro.gif|450px|thumb|Representative animation of Macro Mode. Processing time is ~14 seconds/image.]]
[[File:Stack - Batch.gif|450px|thumb|Representative animation of Batch Mode. Processing time is ~2.5 seconds/image.]]
=== Segmentation ===
The following precesses are executed by the macro:
*'''ONL Segmentation'''
#Blue channel extraction from the RGB native image
#Gaussian blur filter to reduce noise and detail.
#Contrast enhancement
#Tsai moment-preserving thresholding 
#Erosion iterations to achieve a fitted segmentation
#Outlier pixels were removed to a specific radius
#Fill holes function was used to consolidate a solid area.
#Analyze particles function to measure the ONL area.

*'''INL Segmentation'''
#ONL ROI was subtracted from the Gaussian filtered blue channel.
#Tsai moment-preserving thresholding 
#Erosion iterations to achieve a fitted segmentation
#Outlier pixels were removed to a specific radius
#Fill holes function was used to consolidate a solid area.
#Analyze particles function to measure the ONL area.

=== Total Cells Quantitation ===
:Find Maxima function to detect nuclei located in the ONL and INL ROIs

=== TUNEL Cells Quantitation ===
#Green channel extraction from the RGB native image
#Tsai moment-preserving thresholding 
#Watershed function to separate contiguous cells
#Analyze particles function to count
=== Macro Mode vs. Batch Mode ===
TUNEL Cell Counter can be executed either as a macro or as batch process, with the same results.<br> We suggest Batch Mode processing for faster results. <br>
To execute in Macro Mode:
#Open an image or drag-and-drop to the application applet. 
#Go to ''Process > Macro > TUNEL Cell Counter 

To execute in Batch Mode:
#View the macro code from the GitHub link.<br>
#Copy the whole code to the clipboard.
#Correct microscope spatial scale in line 32 of the code, if necessary.
#Go to ''Process > Batch > Macro'' and copy the content in the macro box.
#Select the ''Input" Folder were your images are located
#Select the ''Output" Folder were you want to save the processed images
#Choose JPEG as the "Output Format" (recommended)
#Click on "Process"

== Macro Output ==
=== Qualitative ===
:A JPEG image is created to visualize ONL and INL segmentation and TUNEL<sup>+</sup> cell count, as an overlay.
=== Quantitative ===
When executed as a macro, the output variables are:
:'''Outer Nuclear Layer'''
:*ONL Area (mm<sup>2</sup>)
:*ONL Total Cells (count)
:*ONL TUNEL<sup>+</sup> Cells (count)
:*Ratio TUNEL<sup>+</sup> Cells/ONL Area (count/mm<sup>2</sup>)
:*Percentage TUNEL<sup>+</sup> Cells/ONL Total Cells (%)<br>

:'''Inner Nuclear Layer'''
:*INL Area (mm<sup>2</sup>)
:*INL Total Cells (count)
:*INL TUNEL<sup>+</sup> Cells (count)
:*Ratio TUNEL<sup>+</sup> Cells/INL Area (count/mm<sup>2</sup>)
:*Percentage TUNEL<sup>+</sup> Cells/INL Total Cells (%)
[[File:Bar.png|1200px]]

When executed as Batch Mode, ONL and INL Area, and ONL and INL TUNEL<sup>+</sup> cells are reported.
Ratio of TUNEL<sup>+</sup> Cells can be calculated by any spreadsheet or statistics package. 

== Limitations == 
#Acquisition: The macro was designed for images acquired with a 20x/0.8 air objective. Images with higher or lower magnification will not be successfully segmented. We considered this magnification was the most suitable to assess a reasonably large area without missing out cell morphology details.
#TUNEL staining quality: Images need to have a intense cell staining and low background noise.
#Image Focus: Uneven image focus will render incomplete layer segmentation.
# Indistinguishable Retinal Layers: The macro cannot distinguish between the ONL and INL if you can't!
#Uncentered Image: For best results, try to acquire images centered in the frame.
# Significant Shadowing: Shadowing will render incomplete layer segmentation.

== FAQs ==
# Q: Can I modify the source code?
#*A: ''Yes. You can modify the code to develop new macros or plugins. Please acknowledge previous work that helped or inspired you, and share your contribution with the scientific community!''<br>
# Q: I used this tool for my research. How should I acknowledge it?
#*A: ''Please cite or reference this work as follows: Maidana DE, Tsoka P, Tian B, Dib B, Matsumoto H, Kataoka K, Lin H, Miller JW, Vavvas DG. (2015) A Novel ImageJ Macro for Automated Cell Death Quantitation in the Retina. Currently under revision'' <br>
# Q: I cannot get accurate segmentation or counting. Any advice?
#*A: ''Check your acquisition and post-processing parameters. Try to keep background at minimum, and avoid saturating pixels especially in the green channel. This will balance any noise signal to a real cell. Finally, as a rule of thumb, best performances are obtained with less saturated images.'' <br>

== Future Development ==
Yes, we know there is a lot to improve! <br> 
We are currently working on the following issues:
*Image acquisition: We are working on images obtained with a 10x objective magnification.
*Variables in Batch Processing mode: We are trying to report the complete variable list. 

== Version History ==

:v1.1: In progress.
:v1.0: First and validated working version.

== External Links ==
http://www.masseyeandear.org

== References ==

[1]
